---
title: "CS 670 Final Project R Notebook"
output: html_notebook
---
#
**Introduction**

For my project, I plan to work with the College dataset located in the ISLR2 library created by the authors of the book "An Introduction to Statistical Learning with Applications in R". This dataset was collected by sampling information from 777 colleges from the 1995 issue of US News and World Report which is a news magazine that publishes rankings of colleges within the US. The purpose of collecting this data was to provide a resource for students and researchers to explore the correlation between different factors and the performance of US colleges. Each college is represented in 18 different columns containing statistics on various aspects of that college which include:

1. Private: A factor indicating whether the college is private or public.
2. Apps: The number of applications received by the college.
3. Accept: The number of applications accepted by the college.
4. Enroll: The number of students enrolled at the college.
5. Top10perc: The percentage of students at the college who scored in the top 10% of their high school classes.
6. Top25perc: The percentage of students at the college who scored in the top 25% of their high school classes.
7. F.Undergrad: The number of full time undergraduates at the college.
8. P.Undergrad: The number of part time undergraduates at the college.
9. Outstate: The out-of-state tuition for the college.
10. Room.Board: The cost of room and board at the college.
11. Books: The estimated cost of books for a year of study at the college.
12. Personal: The estimated personal expenses for a year of study at the college.
13. PhD: The percentage of faculty at the college with PhDs.
14. Terminal: The percentage of faculty at the college with terminal degrees
15. S.F.Ratio: The student to faculty ratio at the college.
16. perc.alumni: The percentage of alumni who donate to the college.
17. Expend: The instructional expenditure per student at the college.
18. Grad.Rate: The graduation rate for the college.

Some representation decisions were made when creating this dataset. For example, the Private column was coded as a factor with two levels, "Yes" and "No," rather than a numerical value. This decision was made to avoid issues with comparing private and public colleges based on cost, admission rates, or other factors. Also, the Ph.D. and Terminal columns were represented as percentages rather than numbers to provide a better representation of the faculty's qualifications.


#
**Questions**

My objective is to explore what factors are most correlated with a college's graduation rate as well as to be able to predict accurately a new colleges graduation rate given some data. This analysis will offer insights into the state of higher education in the US and identify what is being paid for. The results of my study could be useful for others who are looking to choose the best college for their needs.

**Visualization**

To understand and gain insights into patterns and trends within the data that are not immediately visible its important to visualize our data. We first can load up all of our libraries we will need and convert all the quantitative data into qualitative using this and saving it into the College_data variable.

```{r}
library(ISLR2)
library(ggplot2)
library(dplyr)
library(glmnet)
library(caret)

College_data = College_quant_data <- na.omit(College) %>%
  mutate_all(~ if(is.factor(.)) {
    as.numeric(as.factor(.))
  } else {
    .
  })
```

We can then start to visualize our data by creating a scatter plot matrices for each variable we are investigating between all other variables as well as listing their correlations.

First we will start with visualizing the scatter plots for the Graduation Rate to see if there's any visual correlations there.

```{r}
par(mfrow = c(3, 3))

colnames <- names(College_data)

for (i in 2:length(colnames) - 1) {
  # make scatter plot of Grad.Rate against the current predictor
  plot(College[,i], College$Grad.Rate, xlab = colnames[i], ylab = "Grad.Rate")
}
cor(College_data)[- which(colnames(College) == "Grad.Rate"), "Grad.Rate"] # print out correlations except the grad to grad
```

Analyzing the graphs and the correlations we can see that the Private, Top10perc, Top20prec, Outstate, Room.Board, phD, S.F.Ratio, perc.alumni and Expend have evidence of being moderately correlated with the Graduation Rate. Using this information we can hypothesize before we fit our model that some of these variables can be related to Graduation rate.

**Modeling**

To achieve my goal, I plan to first use a linear regression model to predict the qualitative responses. I will also experiment with using random forests and decision trees. I also plan to apply k-fold cross-validation and Lasso to ensure the validity of my model, specifically using the Lasso method as I anticipate that not all variables will be linked to the response.

To start we divide the data to be 70% training and 30% testing.

```{r}
set.seed(5) 

alpha = 1
k = 10
lambda = 10^seq(10, -2, length = 100)

# Divide the data into training and test
x = model.matrix(Grad.Rate ~ ., data = College_data)[, -1]
y = College_data$Grad.Rate

train = sample(1:nrow(x), 0.7*nrow(x)) # 70% training data
test = (-train)
y.test <- y[test]
```

Then using these two sets of data we can fit a linear regression model using k-folds and Lasso to predict the Graduation rate.

```{r}
#----------------------------------------------------------------
# Fit on training data
shrink.mod <- glmnet(x[train,], y[train], alpha = alpha, lambda = lambda, family="gaussian")

#------------------------------------------------
# preform cross validation to get the best lambda

cv.out = cv.glmnet(x[train,], y[train], alpha=alpha, nfolds=k, family="gaussian")
bestlam = cv.out$lambda.min

#----------------------------------------------
# Generalization Error
shrink.pred <- predict(shrink.mod , s = bestlam , newx = x[test, ], family="gaussian")

MSE =  mean((shrink.pred - y.test)^2)

message(sprintf("The Mean Squared error is %f", MSE))
```

Now we do it with a decision tree with cross validation.

```{r}
# This time partition our data using indexing
trainIndex <- createDataPartition(College_data$Grad.Rate, p = 0.7, list = FALSE)
training <- College_data[trainIndex, ]
testing <- College_data[-trainIndex, ]

library(rpart)
#----------------------------------------------------------------
# Fit a decision tree on the training data
fit.tree = rpart(Grad.Rate ~ ., data=training)

#------------------------------------------------
# preform cross validation to get the best fit

cv = trainControl(method = "cv", number = 10)
cv.fit = train(Grad.Rate ~ ., data = training, method = "rpart", trControl = cv)

#----------------------------------------------
# Generalization error

pred = predict(fit.tree, testing)
mseTree = mean((pred - testing$Grad.Rate)^2)

pred = predict(cv.fit, testing)
mseCrossTree = mean((pred - testing$Grad.Rate)^2)

summary(fit.tree)
message(sprintf("The Mean Squared error of the decision tree is %f", mseTree))
message(sprintf("The Mean Squared error of the k-fold cross validation decision tree is %f", mseCrossTree))
```

**Results**

This project will provide valuable insights into the correlation between different factors and the performance of US colleges. Through the use of statistical analysis and machine learning techniques, I aim to determine which variables are most significant and provide recommendations for students who are seeking to select the best college for their needs.